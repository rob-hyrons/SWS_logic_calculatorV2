<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Shutter Motor Calculator</title>
    <!-- xlsx.js for data reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- ExcelJS for image extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <!-- Papa Parse for CSV importing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- Link to external CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <img src="https://raw.githubusercontent.com/rob-hyrons/SWS_logic_calculator/main/swslogo.svg" alt="SWS Logo" id="logo-image">
    <div class="container">
        <div class="tabs">
            <button class="tab-button active" data-tab="inputs-content">Inputs</button>
            <button class="tab-button" data-tab="axle-content">Axle</button>
            <button class="tab-button" data-tab="motor-content">Motor</button>
            <button class="tab-button" data-tab="endplate-content">Endplate</button>
            <button class="tab-button" data-tab="safety-brake-content">Safety Brake</button>
            <button class="tab-button" data-tab="wicket-content">Wicket Door</button>
            <button class="tab-button" data-tab="chain-content">Chain</button>
            <button class="tab-button" data-tab="admin-content">Admin</button>
        </div>
        <div class="content-area">
            <h1>Complete Shutter Calculator</h1>
            
            <div class="print-container">
                <button id="printButton">Print Report to PDF</button>
            </div>

            <div class="tab-content">
                <!-- Inputs Tab -->
                <div id="inputs-content" class="tab-pane active">
                    <h2>Shutter Specification</h2>
                    <div class="form-group" data-admin-label="File Import Status">
                         <div id="import-status">Attempting to load data from repository...</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group form-col" data-admin-label="Input Width">
                            <label for="width">Input Width (mm)</label>
                            <input type="number" id="width" placeholder="e.g., 3000">
                            <div id="width-warning" class="width-validation-warning"></div>
                        </div>
                        <div class="form-group form-col" data-admin-label="Width Type">
                            <label for="widthType">Width Type</label>
                            <select id="widthType">
                                <option value="clearOpening">Clear Opening</option>
                                <option value="curtainWidth" selected>Curtain Width</option>
                                <option value="overall">Overall (Reveal)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group form-col" data-admin-label="Guide Type">
                            <label for="guideType">Guide Type</label>
                            <select id="guideType" disabled>
                                <option value="">-- Waiting for file import --</option>
                            </select>
                        </div>
                        <div class="form-group form-col" data-admin-label="Curtain Height">
                            <label for="height">Curtain Height (Floor to Axle Centre, mm)</label>
                            <input type="number" id="height" placeholder="e.g., 4000">
                        </div>
                    </div>
                     <div class="form-group" data-admin-label="Additional Axle Width">
                        <label for="additionalLength">Additional Axle Width (Total, mm)</label>
                        <input type="number" id="additionalLength" placeholder="e.g., 100" value="20">
                    </div>
                    <div class="form-row">
                        <div class="form-group form-col" data-admin-label="Lath Type">
                            <label for="lathType">Lath Type</label>
                            <select id="lathType" disabled>
                                <option value="">-- Waiting for file import --</option>
                            </select>
                        </div>
                        <div class="form-group form-col" data-admin-label="Endlock Type">
                            <label for="endlockType">Endlock Type</label>
                            <select id="endlockType" disabled>
                                <option value="">-- Waiting for file import --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" data-admin-label="Custom Lath Option">
                        <label for="useCustomLath" style="display: inline-block; font-weight: 500; cursor: pointer;">
                            <input type="checkbox" id="useCustomLath" style="width: auto; margin-right: 8px; vertical-align: middle;">Use Custom Lath
                        </label>
                    </div>
                    <div id="custom-lath-options" data-admin-label="Custom Lath Weight" style="display: none; padding-left: 20px; border-left: 3px solid #e9ecef; margin-bottom: 1.5em; margin-top: -1em;">
                        <div class="form-group">
                            <label for="customLathWeight">Custom Lath Weight (kg/m²)</label>
                            <input type="number" id="customLathWeight" placeholder="e.g., 9.5">
                            <small style="font-size: 0.8em; color: #555;">Note: Other properties (thickness, height) will be based on the lath selected above.</small>
                        </div>
                        <div class="form-group">
                            <label for="customTorqueWeight">Custom Curtain Weight for Lift (kg)</label>
                            <input type="number" id="customTorqueWeight" placeholder="e.g., 150.5">
                            <small style="font-size: 0.8em; color: #555;">If a value is entered here, it will override the calculated 'Curtain Weight (for Torque)'.</small>
                        </div>
                    </div>
                    <div id="lath-image-container" style="margin-top: 1em; margin-bottom: 1.5em; text-align: center; display: none;">
                        <img id="lathImageDisplay" src="" alt="Lath Image" style="max-width: 100%; max-height: 100px; border-radius: 4px; border: 1px solid #ccc;">
                    </div>
                    <div class="form-group" data-admin-label="Powder Coated Option">
                        <label for="powderCoated" style="display: inline-block; font-weight: 500; cursor: pointer;">
                            <input type="checkbox" id="powderCoated" style="width: auto; margin-right: 8px; vertical-align: middle;">Powder Coated (+0.5 kg/m²)
                        </label>
                    </div>
                    <div class="form-group" data-admin-label="Bottom Lath Type">
                        <label for="bottomLathType">Bottom Lath Type</label>
                        <select id="bottomLathType" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    
                    <div class="form-group" data-admin-label="Add Vision Slats Option">
                        <label for="addVision" style="display: inline-block; font-weight: 500; cursor: pointer;">
                            <input type="checkbox" id="addVision" style="width: auto; margin-right: 8px; vertical-align: middle;">Add Vision Slats
                        </label>
                    </div>
                    <div id="vision-slat-options" data-admin-label="Vision Slat Details" style="display: none; padding-left: 20px; border-left: 3px solid #e9ecef; margin-bottom: 1.5em; margin-top: -1em;">
                        <div class="form-group">
                            <label for="visionLathType">Vision Lath Type</label>
                            <select id="visionLathType" disabled>
                                <option value="">-- Waiting for file import --</option>
                            </select>
                        </div>
                        <div id="vision-lath-image-container" style="margin-top: 1em; margin-bottom: 1.5em; text-align: center; display: none;">
                            <img id="visionLathImageDisplay" src="" alt="Vision Lath Image" style="max-width: 100%; max-height: 100px; border-radius: 4px; border: 1px solid #ccc;">
                        </div>
                        <div class="form-group">
                            <label for="visionStartHeight">Height to Vision Start (from floor, mm)</label>
                            <input type="number" id="visionStartHeight" placeholder="e.g., 1000">
                            <small style="font-size: 0.8em; color: #555;">This will be adjusted to the nearest lath.</small>
                        </div>
                        <div class="form-group">
                            <label for="visionPanelHeight">Vision Panel Height (mm)</label>
                            <input type="number" id="visionPanelHeight" placeholder="e.g., 500">
                            <small style="font-size: 0.8em; color: #555;">This will be adjusted to the nearest lath.</small>
                        </div>
                    </div>

                    <div class="results">
                        <h3>Shutter Details</h3>
						<p>Curtain Width (Calculated): <span id="calculated-curtain-width">0</span> mm</p>
						<p>Clear Opening (Calculated): <span id="calculated-clear-opening">0</span> mm</p>
						<p>Overall Width (Calculated): <span id="calculated-overall-width">0</span> mm</p>
						<hr>
                        <p>Total Shutter Weight: <span id="weight-kg">0.00</span> kgs</p>
                        <p>Curtain Weight (for Torque): <span id="torque-weight-kg">0.00</span> kgs</p>
                        <p>Total Endlock Weight: <span id="endlock-weight">0.00</span> kgs</p>
                        <p>Total Curtain Area (Material): <span id="curtain-area">0.00</span> m²</p>
						<p>Curtain Area to Lift (Coverage): <span id="lifted-curtain-area">0.00</span> m²</p>
                        <p>Total Applied Friction: <span id="total-applied-friction">0</span> %</p>
                        <p id="vision-area-m2-para" style="display: none;">Total Vision Area: <span id="vision-area-m2">0.00</span> m²</p>
                        <p id="vision-percentage-para" style="display: none;">Overall Vision Percentage: <span id="vision-percentage">0.00</span> %</p>
                        <p>Total Number of Laths: <span id="lath-count">0</span></p>
                        <p>Laths to Lift: <span id="laths-to-lift">0</span></p>
                        <p>Uncompressed Curtain Height: <span id="curtain-height-extended">0</span> mm</p>
                        <p>Compressed Curtain Height: <span id="curtain-height-compressed">0</span> mm</p>
                        <h4 style="margin-top: 1em; margin-bottom: 0.5em; color: #495057;">Motor Recommendation</h4>
                        <p>Max Required Torque: <span id="max-torque-inputs">0.0</span> Nm</p>
                        <p>Selected Motor: <span id="motor-name-inputs">N/A</span></p>
                        <p id="motor-torque-line-inputs">Motor Torque Range: <span id="motor-torque-inputs">0</span> Nm</p>
                    </div>
                    <div id="shutter-graphic-container"></div>
                    <div id="width-graphic-container" class="graph-container"></div>
                </div>

                <!-- Axle Analysis Tab -->
                <div id="axle-content" class="tab-pane">
                    <h2>Axle Deflection Analysis</h2>
                    
                    <div class="form-group" data-admin-label="Axle Shape">
                        <label>Axle Shape</label>
                        <div class="shape-toggle">
                            <input type="radio" id="shapeCircular" name="axleShape" value="circular" checked>
                            <label for="shapeCircular">Circular</label>
                            <input type="radio" id="shapeOctagonal" name="axleShape" value="octagonal">
                            <label for="shapeOctagonal">Octagonal</label>
                        </div>
                    </div>
                    
                    <div class="form-group" data-admin-label="Axle Type Selector">
                        <label for="axleType">Axle Section (Auto-Selected)</label>
                        <select id="axleType" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="collar-size-group" data-admin-label="Collar Size" style="display: none;">
                        <label for="collarSize">Collar Size (mm)</label>
                        <input type="number" id="collarSize" placeholder="e.g., 150" value="0">
                    </div>

                    <div id="deflection-graphic-container" class="graph-container" style="height: 150px;"></div>
                    <div id="axle-cross-section-container" class="graph-container" style="height: 350px; margin-top: 2.5em;"></div>
                    <div class="results">
                        <h3>Axle Performance</h3>
                        <p>Total Axle Length: <span id="total-axle-length">0</span> mm</p>
                        <p>Axle Weight: <span id="axle-weight">0.00</span> kgs</p>
                        <p>Total Weight (for Deflection): <span id="total-deflection-weight">0.00</span> kgs</p>
                        <p>Material Grade: <span id="axle-material-grade">N/A</span></p>
                        <p>Moment of Inertia (I): <span id="moment-of-inertia">0.00</span> mm⁴</p>
                        <p>Calculated Deflection: <span id="axle-deflection">0.00</span> mm</p>
                        <p id="ratio-paragraph">Deflection Ratio: <span id="deflection-ratio">N/A</span></p>
                        <p>Safety Factor: <span id="axle-safety-factor">N/A</span></p>
                    </div>
                    <div id="recommendation-box"></div>
                </div>

                <!-- Motor Tab -->
                <div id="motor-content" class="tab-pane">
                    <h2>Motor & Torque Analysis</h2>
                    <div class="form-group" data-admin-label="Motor Usage Type">
                        <label for="motorUsageFilter">Motor Usage Type</label>
                        <select id="motorUsageFilter" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                     <div class="form-group" data-admin-label="Motor Manufacturer">
                        <label for="motorManufacturerFilter">Motor Manufacturer</label>
                        <select id="motorManufacturerFilter" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                     <div class="form-group" data-admin-label="Motor Voltage">
                        <label for="motorVoltageFilter">Motor Voltage</label>
                        <select id="motorVoltageFilter" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    <div class="form-group" data-admin-label="Motor Mounting Type">
                        <label for="motorMountingType">Motor Mounting Type</label>
                        <select id="motorMountingType" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    <div class="form-group" data-admin-label="Manual Override">
                        <label for="motorManualOverrideFilter">Manual Override</label>
                        <select id="motorManualOverrideFilter" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    <div class="form-group" data-admin-label="Lath Friction Allowance">
                        <label for="friction">Lath Baseline Friction Allowance (%)</label>
                        <input type="number" id="friction" value="10" title="Automatically updated from Lath data. Can be overridden.">
                    </div>
                    <div id="torque-graph-container" class="graph-container" style="height: 280px;"></div>
                    <div class="results">
                        <h3>Torque Calculation</h3>
                        <p>Max Required Torque: <span id="max-torque">0.0</span> Nm</p>
                        <p>Total Revolutions: <span id="total-revolutions">0.0</span></p>
                        <hr>
                        <div class="form-group" data-admin-label="Motor Selector">
                            <label for="motorSelector">Select Motor</label>
                            <select id="motorSelector" disabled>
                                <option>-- First select a mounting type --</option>
                            </select>
                        </div>
                        <h3>Selected Motor Details</h3>
                        <div id="motor-image-container" style="margin-top: 1em; margin-bottom: 1.5em; text-align: center; display: none;">
                            <img id="motorImageDisplay" src="" alt="Motor Image" style="max-width: 100%; max-height: 150px; border-radius: 4px; border: 1px solid #ccc;">
                        </div>
                        <p>Motor Name: <span id="motor-name">N/A</span></p>
                        <p id="motor-torque-line">Motor Torque Range: <span id="motor-torque">0</span> Nm</p>
                        <p>Motor Speed: <span id="motor-rpm">0</span> RPM</p>
                        <p>Driveshaft Diameter: <span id="motor-driveshaft-dia">N/A</span></p>
                        <p>Cycles Per Hour: <span id="motor-cycles-per-hour">N/A</span></p>
                        <p>Opening Time: <span id="opening-time">0</span> seconds</p>
                        <p>Power Consumed per Cycle: <span id="power-consumed">0.0000</span> kWh</p>
                        <p>Motor Limit Turns: <span id="motor-limit-turns">N/A</span></p>
                        <p id="motor-limit-warning" style="display:none; color: #d93025; font-weight: bold;">⚠️ Warning: Required revolutions exceed motor limit.</p>
                    </div>
                </div>
                
                <div id="endplate-content" class="tab-pane page-break-before-print">
                    <h2>Endplate Selection</h2>
                     <div class="form-group" data-admin-label="Endplate Material">
                        <label>Endplate Material</label>
                        <div class="radio-group">
                            <input type="radio" id="matSteel" name="material" value="Steel" checked>
                            <label for="matSteel">Steel</label>
                            <input type="radio" id="matAluminium" name="material" value="Aluminium">
                            <label for="matAluminium">Aluminium</label>
                        </div>
                    </div>
                    <div class="form-group" data-admin-label="Include Deflection in Sizing">
                        <label for="includeDeflectionInSizing" style="display: inline-block; font-weight: 500; cursor: pointer;">
                            <input type="checkbox" id="includeDeflectionInSizing" style="width: auto; margin-right: 8px; vertical-align: middle;">Include Axle Deflection in Coil Sizing
                        </label>
                    </div>
                    <div class="form-group" data-admin-label="Endplate Selector">
                        <label for="endplateSelector">Select Endplate (Auto-Selected)</label>
                        <select id="endplateSelector" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    <div class="results" style="border-left-color: #ffc107;">
                        <h3 style="color: #c79100;">Sizing Details</h3>
                        <p>Maximum Coil Diameter: <span id="max-coil-diameter">0.0</span> mm</p>
                        <p id="effective-coil-para" style="display: none;">Effective Sizing Diameter (inc. deflection): <span id="effective-coil-diameter">0.0</span> mm</p>
                        <hr>
                        <h3>Selected Endplate</h3>
                        <p>Name: <span id="endplate-name">N/A</span></p>
                        <p>Size: <span id="endplate-size">0</span> mm</p>
                        <p>Material: <span id="endplate-material">N/A</span></p>
                        <hr>
                        <h4>Curtain Height Limits by Endplate</h4>
                        <p>For Next Size Down (<span id="prev-endplate-name">N/A</span>): <span id="prev-endplate-height">N/A</span> mm</p>
                        <p>For Next Size Up (<span id="next-endplate-name">N/A</span>): <span id="next-endplate-height">N/A</span> mm</p>
                    </div>
                    <div id="endplate-graphic-container" class="graph-container"></div>
                    <div class="results page-break-before-print" style="border-left-color: #6f42c1; margin-top: 2em;">
                        <h3 style="color: #5a32a3;">Fixing Forces Analysis (Per Endplate, inc. 20% Safety Factor)</h3>
                        <p>Total Downward Shear Force: <span id="endplate-downward-force">0</span> N</p>
                        <p>Resultant Pull-out Force (on top fixing): <span id="endplate-pullout-force">0</span> N</p>
                    </div>
                    <div id="endplate-force-diagram-container" class="graph-container" style="height: 250px; margin-top: 1.5em;"></div>
                </div>

                <!-- Safety Brake Tab -->
                <div id="safety-brake-content" class="tab-pane">
                    <h2>Safety Brake Selection</h2>
                    
                    <div class="form-group" data-admin-label="Safety Brake Selector">
                        <label for="safetyBrakeSelector">Available Safety Brakes (Auto-Selected based on Operating Torque)</label>
                        <select id="safetyBrakeSelector" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    
                    <div id="safety-brake-image-container" style="margin-top: 1em; margin-bottom: 1.5em; text-align: center; display: none;">
                        <img id="safetyBrakeImageDisplay" src="" alt="Safety Brake Image" style="max-width: 100%; max-height: 100px; border-radius: 4px; border: 1px solid #ccc;">
                    </div>

                    <div class="results" style="border-left-color: #d93025;">
                        <h3 style="color: #d93025;">Selected Brake</h3>
                        <p>Selected Safety Brake: <span id="safety-brake-name">N/A</span></p>
                        <p>Brake Operating Torque Rating: <span id="safety-brake-capacity">N/A</span> Nm</p>
                        <p>Required Motor Torque (Max): <span id="safety-brake-motor-torque">N/A</span> Nm</p>
                        <p>Brake Shaft Diameter: <span id="safety-brake-driveshaft">N/A</span></p>
                    </div>

                    <div class="calculation-explainer">
                        <h4>Selection Logic Explained</h4>
                        This safety brake is selected by comparing the <strong>Max Motor Torque</strong> against the <strong>Operating Torque (Nm)</strong> column in the SafetyB data sheet. The first available brake with an Operating Torque greater than the motor torque is selected.
                    </div>
                </div>
                
                <div id="wicket-content" class="tab-pane">
                    <h2>Wicket Door Selection</h2>
                    <div class="form-group" data-admin-label="Wicket Door Selector">
                        <label for="wicketDoorSelector">Available Wicket Doors</label>
                        <select id="wicketDoorSelector" disabled>
                            <option value="">-- Waiting for file import --</option>
                        </select>
                    </div>
                    <div class="results" style="border-left-color: #00bcd4;">
                        <h3 style="color: #00838f;">Selected Wicket Door</h3>
                        <p>Name: <span id="wicket-door-name">N/A</span></p>
                        <p>Height: <span id="wicket-door-height">0</span> mm</p>
                        <p>Width: <span id="wicket-door-width">0</span> mm</p>
                        <hr>
                        <p>Laths Level with Wicket Door: <span id="laths-at-wicket">0</span></p>
                        <p>Height to Top of Wicket Laths: <span id="wicket-lath-height">0</span> mm</p>
                        <h3 style="margin-top: 1.5em;">Adjusted Motor Torque</h3>
                        <p>Max Required Torque (with Wicket): <span id="wicket-max-torque">0.0</span> Nm</p>
                    </div>
                    <div id="wicket-graphic-container"></div>
                    <div id="wicket-torque-graph-container" class="graph-container" style="height: 280px;"></div>
                </div>

                <!-- Chain Drive Tab -->
                <div id="chain-content" class="tab-pane">
                    <h2>Chain Drive Calculation</h2>
                    <div class="form-group" data-admin-label="Chain Type">
                        <label>Chain Size / Type</label>
                        <input type="text" id="chainSizeDisplay" readonly placeholder="Auto-selected based on motor" style="background-color: #e9ecef;">
                    </div>
                    <div class="form-row">
                        <div class="form-group form-col" data-admin-label="Motor Sprocket">
                            <label for="motorTeeth">Motor Sprocket Teeth</label>
                            <input type="number" id="motorTeeth" placeholder="-" readonly style="background-color: #e9ecef;">
                        </div>
                        <div class="form-group form-col" data-admin-label="Plate Wheel">
                            <label for="barrelTeeth">Barrel Plate Wheel Teeth</label>
                            <input type="number" id="barrelTeeth" placeholder="-" readonly style="background-color: #e9ecef;">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group form-col" data-admin-label="Sprocket Diameter">
                            <label>Sprocket Diameter (mm)</label>
                            <input type="number" id="sprocketDiameter" placeholder="-" readonly style="background-color: #e9ecef;">
                        </div>
                        <div class="form-group form-col" data-admin-label="Plate Wheel Diameter">
                            <label>Plate Wheel Diameter (mm)</label>
                            <input type="number" id="plateWheelDiameter" placeholder="-" readonly style="background-color: #e9ecef;">
                        </div>
                    </div>
                    <div class="form-group" data-admin-label="Chain Pitch">
                        <label for="chainPitch">Chain Pitch (mm)</label>
                        <input type="number" id="chainPitch" value="12.7" placeholder="e.g., 12.7 for 08B/1/2 inch">
                        <small style="font-size: 0.8em; color: #555;">Used for graphic sizing.</small>
                    </div>
                    
                    <div class="results" style="border-left-color: #ffc107;">
                        <h3 style="color: #c79100;">Gear Ratio & Strain Analysis</h3>
                        <p>Gear Ratio: <span id="chain-ratio">1 : 1.0</span></p>
                        <p>Torque Required at Barrel: <span id="chain-torque-barrel">0.0</span> Nm</p>
                        <p>Torque Required at Motor: <span id="chain-torque-motor">0.0</span> Nm</p>
                        <hr>
                        <p>Calculated Chain Tension: <span id="chain-tension-n">0.0</span> N (<span id="chain-tension">0.0</span> kgf)</p>
                        <p>Chain Breaking Strain: <span id="chain-breaking-load-n">0.0</span> N</p>
                        <p>Safety Factor (Target > 6.0): <span id="chain-safety-factor">N/A</span></p>
                    </div>
                    
                    <div id="chain-graphic-container" class="graph-container" style="height: 300px; border: 1px solid #e9ecef; border-radius: 4px; background-color: white;"></div>
                </div>

                <!-- Admin Tab -->
                <div id="admin-content" class="tab-pane">
                    <h2>Admin Controls</h2>
                    
                    <div class="admin-section">
                        <h3>Import from CSV</h3>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1em;">
                            <input type="file" id="csvFileInput" accept=".csv" style="flex-grow: 1;">
                            <button id="importCsvButton">Import</button>
                        </div>
                        <div id="import-status-admin" style="font-style: italic; color: #555;"></div>
                    </div>

                    <div class="admin-section">
                        <h3>Tab Visibility</h3>
                        <div class="admin-button-group">
                            <button id="tabsSelectAll">Select All</button>
                            <button id="tabsDeselectAll">Deselect All</button>
                        </div>
                        <div id="tab-controls-container" class="admin-controls"></div>
                    </div>

                    <div class="admin-section">
                        <h3>Input Option Visibility</h3>
                         <div class="admin-button-group">
                            <button id="inputsSelectAll">Select All</button>
                            <button id="inputsDeselectAll">Deselect All</button>
                        </div>
                        <div id="input-controls-container" class="admin-controls"></div>
                    </div>

                    <!-- NEW: AXLE CALCULATION SETTINGS -->
                    <div class="admin-section">
                        <h3>Axle Calculation Settings</h3>
                        <div class="form-group">
                            <label for="axleFixity">Axle Support Condition (%)</label>
                            <input type="number" id="axleFixity" min="0" max="100" value="20">
                            <small style="color: #555; display: block; margin-top: 0.5em;">
                                0% = Simply Supported Beam (Standard, uses 5/384)<br>
                                100% = Fully Fixed/Built-in Beam (Rigid, uses 1/384)<br>
                                Values in between will interpolate the calculation coefficient.
                            </small>
                        </div>
                    </div>

                    <!-- REPORT GENERATION -->
                    <div id="csv-report-section" class="admin-section">
                        <h3>Generate Sizing Report</h3>
                        <p>Configure the report parameters below.</p>
                        
                        <h4>1. Define Size Range (mm)</h4>
                        <div class="report-controls-grid">
                            <div class="form-group">
                                <label for="reportMinWidth">Min Width</label>
                                <input type="number" id="reportMinWidth" value="1000">
                            </div>
                            <div class="form-group">
                                <label for="reportMaxWidth">Max Width</label>
                                <input type="number" id="reportMaxWidth" value="10000">
                            </div>
                             <div class="form-group">
                                <label for="reportInterval">Interval</label>
                                <input type="number" id="reportInterval" value="100">
                            </div>
                            <div class="form-group">
                                <label for="reportMinHeight">Min Height</label>
                                <input type="number" id="reportMinHeight" value="1000">
                            </div>
                            <div class="form-group">
                                <label for="reportMaxHeight">Max Height</label>
                                <input type="number" id="reportMaxHeight" value="10000">
                            </div>
                        </div>

                        <h4>2. Select Shutter Configuration</h4>
                        <div class="form-row">
                            <!-- UPDATED: Primary Lath -->
                            <div class="form-group form-col">
                                <label for="reportLathType">Primary Lath Type</label>
                                <select id="reportLathType">
                                    <option value="">-- Loading... --</option>
                                </select>
                                <small style="color:#666;">Used up to the width limit below.</small>
                            </div>
                            <!-- NEW: Switch Limit -->
                            <div class="form-group form-col">
                                <label for="reportLathLimit">Switch Width (mm)</label>
                                <input type="number" id="reportLathLimit" placeholder="e.g. 4000">
                                <small style="color:#666;">Width to switch to Secondary Lath.</small>
                            </div>
                            <!-- NEW: Secondary Lath -->
                            <div class="form-group form-col">
                                <label for="reportLathType2">Secondary Lath Type</label>
                                <select id="reportLathType2">
                                    <option value="">-- None (Use Primary) --</option>
                                </select>
                                <small style="color:#666;">Used when Width > Switch Width.</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group form-col">
                                <label for="reportEndlockType">Endlock Type</label>
                                <select id="reportEndlockType">
                                    <option value="">-- Loading... --</option>
                                </select>
                            </div>
                            <div class="form-group form-col">
                                <label for="reportBottomLathType">Bottom Lath Type</label>
                                <select id="reportBottomLathType">
                                    <option value="">-- Loading... --</option>
                                </select>
                            </div>
                        </div>

                        <!-- NEW: Collar Override Section -->
                        <h4>Optional: Axle Collar Specific Override</h4>
                        <div class="form-row" style="background-color: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #e9ecef;">
                            <div class="form-group form-col">
                                <label for="reportAxleMatch">Axle Diameter to Match (mm)</label>
                                <input type="number" id="reportAxleMatch" placeholder="e.g. 101.6">
                                <small style="color:#666;">Apply collar only to axles of this size.</small>
                            </div>
                            <div class="form-group form-col">
                                <label for="reportCollarOverride">Collar Diameter (mm)</label>
                                <input type="number" id="reportCollarOverride" placeholder="e.g. 120">
                                <small style="color:#666;">Used for Torque calculation instead of Axle Dia.</small>
                            </div>
                        </div>

                        <h4>3. Select Motor Usage Types</h4>
                        <div class="admin-button-group">
                            <button id="reportUsageSelectAll">Select All</button>
                            <button id="reportUsageDeselectAll">Deselect All</button>
                        </div>
                        <div id="report-motor-usage-filter-container" class="report-filter-container">
                            <p>Loading motor data...</p>
                        </div>

                        <h4>4. Select Motor Manufacturers to Include</h4>
                        <div class="admin-button-group">
                            <button id="reportMotorSelectAll">Select All</button>
                            <button id="reportMotorDeselectAll">Deselect All</button>
                        </div>
                        <div id="report-motor-filter-container" class="report-filter-container">
                            <p>Loading motor data...</p>
                        </div>
                        
                        <h4>5. Select Motor Voltages to Include</h4>
                        <div class="admin-button-group">
                            <button id="reportVoltageSelectAll">Select All</button>
                            <button id="reportVoltageDeselectAll">Deselect All</button>
                        </div>
                        <div id="report-motor-voltage-filter-container" class="report-filter-container">
                            <p>Loading motor data...</p>
                        </div>

                        <h4>6. Select Motor Mounting Types to Include</h4>
                        <div class="admin-button-group">
                            <button id="reportMountingSelectAll">Select All</button>
                            <button id="reportMountingDeselectAll">Deselect All</button>
                        </div>
                        <div id="report-motor-mounting-filter-container" class="report-filter-container">
                            <p>Loading motor data...</p>
                        </div>

                        <div class="admin-button-group" style="margin-top: 1.5em;">
                            <button id="generateCsvButton">Generate and Download CSV Report</button>
                        </div>
                        <div id="csv-generation-status" style="font-style: italic; color: #555;"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <!-- External JS Logic -->
    <script src="script.js"></script>
</body>
</html>